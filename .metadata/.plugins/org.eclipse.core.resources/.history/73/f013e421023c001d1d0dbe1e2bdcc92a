/*
 * DTH11.c
 *
 *  Created on: 24-Sep-2022
 *      Author: Sanjay
 */

#include	"main.h"
#include 	"DTH11.h"


static uint8_t dht11_read(void);				//Private function
static SetPin_as_Output(dht11_typedef_t* dht11);//Private function
static SetPin_as_Input(dht11_typedef_t* dht11);	//Private Functions
/*
 * Initilize dht11 pins
 */
void dht11_Init(dht11_typedef_t* dht11){
	/* Enable gpio Clock */
	uint8_t gpio=dht11->dthport;
	if(gpio==GPIOA){
		__HAL_RCC_GPIOA_CLK_ENABLE();
	}
	else if(gpio==GPIOB){
		__HAL_RCC_GPIOB_CLK_ENABLE();
	}
	else if(gpio==GPIOC){
		__HAL_RCC_GPIOC_CLK_ENABLE();
	}
	else if(gpio==GPIOD){
		__HAL_RCC_GPIOD_CLK_ENABLE();
	}
	else if(gpio==GPIOE){
		__HAL_RCC_GPIOE_CLK_ENABLE();
	}
	else if(gpio==GPIOF){
		__HAL_RCC_GPIOF_CLK_ENABLE();
	}
	else if(gpio==GPIOG){
		__HAL_RCC_GPIOG_CLK_ENABLE();
	}
	else if(gpio==GPIOH){
		__HAL_RCC_GPIOH_CLK_ENABLE();
	}
	else if(gpio==GPIOI){
		__HAL_RCC_GPIOI_CLK_ENABLE();
	}
	else if(gpio==GPIOJ){
		__HAL_RCC_GPIOJ_CLK_ENABLE();
	}
	else if(gpio==GPIOK){
		__HAL_RCC_GPIOK_CLK_ENABLE();
	}

	/*Set up Gpio Pin*/
	SetPin_as_Output(dht11);
}

void dht11_DeInit(dht11_typedef_t* dht11){
	uint8_t gpio=dht11->dthport;
		if(gpio==GPIOA){
			__HAL_RCC_GPIOA_CLK_DISABLE();
		}
		else if(gpio==GPIOB){
			__HAL_RCC_GPIOB_CLK_DISABLE();
		}
		else if(gpio==GPIOC){
			__HAL_RCC_GPIOC_CLK_DISABLE();
		}
		else if(gpio==GPIOD){
			__HAL_RCC_GPIOD_CLK_DISABLE();
		}
		else if(gpio==GPIOE){
			__HAL_RCC_GPIOE_CLK_DISABLE();
		}
		else if(gpio==GPIOF){
			__HAL_RCC_GPIOF_CLK_DISABLE();
		}
		else if(gpio==GPIOG){
			__HAL_RCC_GPIOG_CLK_DISABLE();
		}
		else if(gpio==GPIOH){
			__HAL_RCC_GPIOH_CLK_DISABLE();
		}
		else if(gpio==GPIOI){
			__HAL_RCC_GPIOI_CLK_DISABLE();
		}
		else if(gpio==GPIOJ){
			__HAL_RCC_GPIOJ_CLK_DISABLE();
		}
		else if(gpio==GPIOK){
			__HAL_RCC_GPIOK_CLK_DISABLE();
		}
}

void dht11_Start(dht11_typedef_t* dht11){
	//Refer dataSheet
	/*	1.pull pin low for 18us
	 * 	2.pull the pin high for 30us
	 * 	3.Set the pin mode to input
	 */
	HAL_GPIO_WritePin(dht11->dthport, dht11->dthpin, GPIO_PIN_RESET);
	delayus(18); //to be implemented in main.c
	HAL_GPIO_WritePin(dht11->dthport, dht11->dthpin, GPIO_PIN_SET);
	delayus(30);
	SetPin_as_Input(dht11);
}


uint8_t checkdht11status(dht11_typedef_t* dht11){
	dht11_data.status=0;

}
















static SetPin_as_Input(dht11_typedef_t* dht11){
	GPIO_InitTypeDef Gpiodht11;
	Gpiodht11.Pin=dht11->dthpin;
	Gpiodht11.Mode=GPIO_MODE_INPUT;
	Gpiodht11.Pull=GPIO_PULLUP;
	Gpiodht11.Speed=GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(dht11->dthport, &Gpiodht11);
}

static SetPin_as_Output(dht11_typedef_t* dht11){
	GPIO_InitTypeDef Gpiodht11;
	Gpiodht11.Pin=dht11->dthpin;
	Gpiodht11.Mode=GPIO_MODE_OUTPUT_PP;
	Gpiodht11.Speed=GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(dht11->dthport, &Gpiodht11);
}
